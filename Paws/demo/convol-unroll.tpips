echo c     OPTIMIZATION BY UNROLLING OF LOOP 100 AND 200,
echo c     AND BY REPETITIVE PARTIAL EVALUATION
# Optimization by unrolling of loop 100 and 200,
# and by repetitive partial evaluation

delete convol-unroll
create convol-unroll convol-unroll.f

setproperty	PRETTYPRINT_STATEMENT_NUMBER FALSE

echo c     SHOW convolution FUNCTION
echo 
# Show convolution function

module convol
display PRINTED_FILE

echo c     SHOW main PROGRAM
echo 
# Show main program
#
module IMAGE_PROCESSING
display PRINTED_FILE

echo c     SHOW INTERPROCEDURAL PRECONDITIONS FOR MODULE convol
echo 
# Show interprocedural preconditions for module convol
#
module convol

activate INTERPROCEDURAL_SUMMARY_PRECONDITION
activate PRECONDITIONS_INTER_FULL 
activate TRANSFORMERS_INTER_FULL  

activate PRINT_CODE_PRECONDITIONS
display PRINTED_FILE

activate PRINT_CODE

echo c     AFTER CONSTANT PROPAGATION
echo 
# Propagate constants (cloning could be used too)
#
apply PARTIAL_EVAL
display PRINTED_FILE 

echo c     AFTER FULL UNROLLING OF THE TWO INTERNAL LOOPS
echo 
# Unroll internal loops
#
apply FULL_UNROLL
100

apply FULL_UNROLL
200
display PRINTED_FILE

apply PRINT_DOT_DEPENDENCE_GRAPH[CONVOL]

echo c     AFTER USELESS VARIABLES ELIMINATION

# Eliminate useless variables
#

setproperty MEMORY_EFFECTS_ONLY FALSE

apply DEAD_CODE_ELIMINATION
display PRINTED_FILE

echo c     SUBSCRIPTED EXPRESSIONS HAVE BEEN ELIMINATED BY PARTIAL EVALUATION
echo 
# Simplify subscript expressions
#
apply PARTIAL_EVAL
display PRINTED_FILE 

echo c     PARALLELIZED LOCALITY WITH A LOOP INTERCHANGE
echo 

activate NEST_PARALLELIZATION
display PARALLELPRINTED_FILE

quit
