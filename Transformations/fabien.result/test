
Check that parameters are well evaluated
----------------------------------------

Preconditions when using Fortran parameters


C  P() {}

      PROGRAM FABIEN
      IMPLICIT INTEGER(A-Z)

c     Problem with expression normalization

      INTEGER N, M, I
      PARAMETER(N=101, M=24, L1=MIN(N,M), L2=MAX(N,M), L3=M**2, 
     &     L4=MOD(N,M), L5=N/M)

C  P() {}


c     Alternative to PARAMETER (partial evaluation)
csecond      n = 101
csecond      m = 24
csecond      l1 = min(n,m)
csecond      l2=max(n,m)
csecond      l3=m**2
csecond      l4=mod(n,m)
csecond      l5=n/m

c     Check that parameters are properly evaluated (eval.c)

      J1 = L1                                                           0001

C  P(J1) {J1==24}

      J2 = L2                                                           0002

C  P(J1,J2) {J1==24, J2==101}

      J3 = L3                                                           0003

C  P(J1,J2,J3) {J1==24, J2==101, J3==576}

      J4 = L4                                                           0004

C  P(J1,J2,J3,J4) {J1==24, J2==101, J3==576, J4==5}

      J5 = L5                                                           0005

C  P(J1,J2,J3,J4,J5) {J1==24, J2==101, J3==576, J4==5, J5==4}

      PRINT *, J1, J2, J3, J4, J5                                       0006

C  P(J1,J2,J3,J4,J5) {J1==24, J2==101, J3==576, J4==5, J5==4}


c     Check expression normalization or partial evaluation

      I1 = MIN(N, M)                                                    0007

C  P(I1,J1,J2,J3,J4,J5) {I1==24, J1==24, J2==101, J3==576, J4==5,
C    J5==4}

      I1 = MIN0(N, M)                                                   0008

C  P(I1,J1,J2,J3,J4,J5) {I1==24, J1==24, J2==101, J3==576, J4==5,
C    J5==4}

      I2 = MAX(N, M)                                                    0009

C  P(I1,I2,J1,J2,J3,J4,J5) {I1==24, I2==101, J1==24, J2==101, J3==576,
C    J4==5, J5==4}

      I2 = MAX0(N, M)                                                   0010

C  P(I1,I2,J1,J2,J3,J4,J5) {I1==24, I2==101, J1==24, J2==101, J3==576,
C    J4==5, J5==4}

      I3 = M**2                                                         0011

C  P(I1,I2,I3,J1,J2,J3,J4,J5) {I1==24, I2==101, I3==576, J1==24,
C    J2==101, J3==576, J4==5, J5==4}

      I4 = MOD(N, M)                                                    0012

C  P(I1,I2,I3,I4,J1,J2,J3,J4,J5) {I1==24, I2==101, I3==576, I4==5,
C    J1==24, J2==101, J3==576, J4==5, J5==4}

      I5 = N/M                                                          0013

C  P(I1,I2,I3,I4,I5,J1,J2,J3,J4,J5) {I1==24, I2==101, I3==576, I4==5,
C    I5==4, J1==24, J2==101, J3==576, J4==5, J5==4}

      PRINT *, I1, I2, I3, I4, I5                                       0014

      END

Code after partial evaluation elimination when using Fortran parameters

      PROGRAM FABIEN
      IMPLICIT INTEGER(A-Z)

c     Problem with expression normalization

      INTEGER N, M, I
      PARAMETER(N=101, M=24, L1=MIN(N,M), L2=MAX(N,M), L3=M**2, 
     &     L4=MOD(N,M), L5=N/M)

c     Alternative to PARAMETER (partial evaluation)
csecond      n = 101
csecond      m = 24
csecond      l1 = min(n,m)
csecond      l2=max(n,m)
csecond      l3=m**2
csecond      l4=mod(n,m)
csecond      l5=n/m

c     Check that parameters are properly evaluated (eval.c)

      J1 = 24                                                           0001
      J2 = 101                                                          0002
      J3 = 576                                                          0003
      J4 = 5                                                            0004
      J5 = 4                                                            0005
      PRINT *, 24, 101, 576, 5, 4                                       0006

c     Check expression normalization or partial evaluation

      I1 = 24                                                           0007
      I1 = 24                                                           0008
      I2 = 101                                                          0009
      I2 = 101                                                          0010
      I3 = 576                                                          0011
      I4 = 5                                                            0012
      I5 = 4                                                            0013
      PRINT *, 24, 101, 576, 5, 4                                       0014

      END

Check that variables are well evaluated
----------------------------------------

Preconditions when using Fortran variables


C  P() {}

      PROGRAM FABIEN
      IMPLICIT INTEGER(A-Z)

c     Problem with expression normalization

      INTEGER N, M, I

C  P() {}

cfirst      parameter(n=101, m=24, l1=min(n,m), l2=max(n,m), l3=m**2, 
cfirst     &     l4=mod(n,m), l5=n/m)

c     Alternative to PARAMETER (partial evaluation)
      N = 101                                                           0001

C  P(N) {N==101}

      M = 24                                                            0002

C  P(M,N) {M==24, N==101}

      L1 = MIN(N, M)                                                    0003

C  P(L1,M,N) {M==24, N==101, L1<=24}

      L2 = MAX(N, M)                                                    0004

C  P(L1,L2,M,N) {M==24, N==101, L1<=24, 101<=L2}

      L3 = M**2                                                         0005

C  P(L1,L2,L3,M,N) {M==24, N==101, L1<=24, 101<=L2, 24<=L3}

      L4 = MOD(N, M)                                                    0006

C  P(L1,L2,L3,L4,M,N) {M==24, N==101, L1<=24, 101<=L2, 24<=L3}

      L5 = N/M                                                          0007

C  P(L1,L2,L3,L4,L5,M,N) {M==24, N==101, L1<=24, 101<=L2, 24<=L3}


c     Check that parameters are properly evaluated (eval.c)

      J1 = L1                                                           0008

C  P(J1,L1,L2,L3,L4,L5,M,N) {J1==L1, M==24, N==101, J1<=24, 101<=L2,
C    24<=L3}

      J2 = L2                                                           0009

C  P(J1,J2,L1,L2,L3,L4,L5,M,N) {J1==L1, J2==L2, M==24, N==101, J1<=24,
C    101<=J2, 24<=L3}

      J3 = L3                                                           0010

C  P(J1,J2,J3,L1,L2,L3,L4,L5,M,N) {J1==L1, J2==L2, J3==L3, M==24,
C    N==101, J1<=24, 101<=J2, 24<=J3}

      J4 = L4                                                           0011

C  P(J1,J2,J3,J4,L1,L2,L3,L4,L5,M,N) {J1==L1, J2==L2, J3==L3, J4==L4,
C    M==24, N==101, J1<=24, 101<=J2, 24<=J3}

      J5 = L5                                                           0012

C  P(J1,J2,J3,J4,J5,L1,L2,L3,L4,L5,M,N) {J1==L1, J2==L2, J3==L3,
C    J4==L4, J5==L5, M==24, N==101, J1<=24, 101<=J2, 24<=J3}

      PRINT *, J1, J2, J3, J4, J5                                       0013

C  P(J1,J2,J3,J4,J5,L1,L2,L3,L4,L5,M,N) {J1==L1, J2==L2, J3==L3,
C    J4==L4, J5==L5, M==24, N==101, J1<=24, 101<=J2, 24<=J3}


c     Check expression normalization or partial evaluation

      I1 = MIN(N, M)                                                    0014

C  P(I1,J1,J2,J3,J4,J5,L1,L2,L3,L4,L5,M,N) {J1==L1, J2==L2, J3==L3,
C    J4==L4, J5==L5, M==24, N==101, I1<=24, J1<=24, 101<=J2, 24<=J3}

      I1 = MIN0(N, M)                                                   0015

C  P(I1,J1,J2,J3,J4,J5,L1,L2,L3,L4,L5,M,N) {J1==L1, J2==L2, J3==L3,
C    J4==L4, J5==L5, M==24, N==101, I1<=24, J1<=24, 101<=J2, 24<=J3}

      I2 = MAX(N, M)                                                    0016

C  P(I1,I2,J1,J2,J3,J4,J5,L1,L2,L3,L4,L5,M,N) {J1==L1, J2==L2, J3==L3,
C    J4==L4, J5==L5, M==24, N==101, I1<=24, 101<=I2, J1<=24, 101<=J2,
C    24<=J3}

      I2 = MAX0(N, M)                                                   0017

C  P(I1,I2,J1,J2,J3,J4,J5,L1,L2,L3,L4,L5,M,N) {J1==L1, J2==L2, J3==L3,
C    J4==L4, J5==L5, M==24, N==101, I1<=24, 101<=I2, J1<=24, 101<=J2,
C    24<=J3}

      I3 = M**2                                                         0018

C  P(I1,I2,I3,J1,J2,J3,J4,J5,L1,L2,L3,L4,L5,M,N) {J1==L1, J2==L2,
C    J3==L3, J4==L4, J5==L5, M==24, N==101, I1<=24, 101<=I2, 24<=I3,
C    J1<=24, 101<=J2, 24<=J3}

      I4 = MOD(N, M)                                                    0019

C  P(I1,I2,I3,I4,J1,J2,J3,J4,J5,L1,L2,L3,L4,L5,M,N) {J1==L1, J2==L2,
C    J3==L3, J4==L4, J5==L5, M==24, N==101, I1<=24, 101<=I2, 24<=I3,
C    J1<=24, 101<=J2, 24<=J3}

      I5 = N/M                                                          0020

C  P(I1,I2,I3,I4,I5,J1,J2,J3,J4,J5,L1,L2,L3,L4,L5,M,N) {J1==L1,
C    J2==L2, J3==L3, J4==L4, J5==L5, M==24, N==101, I1<=24, 101<=I2,
C    24<=I3, J1<=24, 101<=J2, 24<=J3}

      PRINT *, I1, I2, I3, I4, I5                                       0021

      END

Code after partial evaluation when using Fortran variables

      PROGRAM FABIEN
      IMPLICIT INTEGER(A-Z)

c     Problem with expression normalization

      INTEGER N, M, I
cfirst      parameter(n=101, m=24, l1=min(n,m), l2=max(n,m), l3=m**2, 
cfirst     &     l4=mod(n,m), l5=n/m)

c     Alternative to PARAMETER (partial evaluation)
      N = 101                                                           0001
      M = 24                                                            0002
      L1 = 24                                                           0003
      L2 = 101                                                          0004
      L3 = 576                                                          0005
      L4 = 5                                                            0006
      L5 = 4                                                            0007

c     Check that parameters are properly evaluated (eval.c)

      J1 = 24                                                           0008
      J2 = 101                                                          0009
      J3 = 576                                                          0010
      J4 = 5                                                            0011
      J5 = 4                                                            0012
      PRINT *, 24, 101, 576, 5, 4                                       0013

c     Check expression normalization or partial evaluation

      I1 = 24                                                           0014
      I1 = 24                                                           0015
      I2 = 101                                                          0016
      I2 = 101                                                          0017
      I3 = 576                                                          0018
      I4 = 5                                                            0019
      I5 = 4                                                            0020
      PRINT *, 24, 101, 576, 5, 4                                       0021

      END
