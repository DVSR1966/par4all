#!/bin/sh

# Please, detect badly nested ENDDO, ENDDIF and wrong lhs

tpips=${tpips_version:-tpips}
PIPS_VALIDDIR=${PIPS_VALIDDIR:-$PIPS_ROOT/Validation}

# Initialization:
# rm -f corinne.result/test
# tpips >corinne.result/test <<EOF

#
# Conflict name between common, subroutine and program
#

($tpips 2>&1 | sed '/file *\//d' | sed '/^shell/d') <<EOF

shell rm -f corinne1.f corinne2.f corinne3.f

echo
echo First try: detect extra ENDDO
echo

shell sed /cfirst/s/cfirst// $PIPS_VALIDDIR/Syntax/corinne.f >corinne1.f
shell sleep 1

delete corinne
create corinne corinne1.f
display PRINTED_FILE
close
delete corinne
shell rm corinne1.f

echo
echo Second try: detect wrong lhs
echo

shell sed /csecond/s/csecond// $PIPS_VALIDDIR/Syntax/corinne.f >corinne2.f
shell sleep 1

create corinne corinne2.f
display PRINTED_FILE
close
delete corinne
shell rm corinne2.f

echo
echo Third try: detect extra ENDDIF
echo

shell sed /cthird/s/cthird// $PIPS_VALIDDIR/Syntax/corinne.f >corinne3.f
shell sleep 1

create corinne corinne3.f
display PRINTED_FILE
close
delete corinne

shell rm corinne3.f

echo
echo Fourth try: detect IF/ENDDO pair
echo

create corinne $PIPS_VALIDDIR/Syntax/corinne.f
module IFENDDO
display PRINTED_FILE
close
delete corinne

echo
echo Fifth try: detect DO/ENDIF pair
echo

create corinne $PIPS_VALIDDIR/Syntax/corinne.f
module DOENDIF
display PRINTED_FILE
close
delete corinne

quit

EOF
