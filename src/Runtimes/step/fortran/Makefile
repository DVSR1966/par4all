# $Id: Makefile 12535 2006-08-17 17:41:40Z coelho $

TARGET = libstep.a

FC = mpif77

FFLAGS = -g -O2

LOCAL_CPP_FLAG = -P -traditional-cpp
FILTRE = ./step_filtre_macro

$(TARGET): STEP.o
	ar rcs $@ $^

COM_SUBROUTINES.f: COM_SUBROUTINES.F
	cpp $(LOCAL_CPP_FLAG) -U INTERLACED $< | $(FILTRE) > $@

COM_SUBROUTINES_BODY.f: COM_SUBROUTINES.f STEP_COM_SUBROUTINES_BODY.F
	cpp $(LOCAL_CPP_FLAG) -U INTERLACED STEP_COM_SUBROUTINES_BODY.F | $(FILTRE) > $@

STEP_COM_SUBROUTINES_BODY.f: COM_SUBROUTINES_BODY.f
	cpp $(LOCAL_CPP_FLAG) -U INTERLACED $< | $(FILTRE) > $@

COM_SUBROUTINES_INTERLACED.f: COM_SUBROUTINES.F
	cpp $(LOCAL_CPP_FLAG) -D INTERLACED $< | $(FILTRE) > $@

COM_SUBROUTINES_BODY_INTERLACED.f: COM_SUBROUTINES_INTERLACED.f STEP_COM_SUBROUTINES_BODY.F
	cpp $(LOCAL_CPP_FLAG) -D INTERLACED STEP_COM_SUBROUTINES_BODY.F | $(FILTRE) > $@

STEP_COM_SUBROUTINES_BODY_INTERLACED.f: COM_SUBROUTINES_BODY_INTERLACED.f
	cpp $(LOCAL_CPP_FLAG) -D INTERLACED $< | $(FILTRE) > $@

STEP.f: STEP.F STEP_COM_SUBROUTINES_BODY.f STEP_COM_SUBROUTINES_BODY_INTERLACED.f
	cpp $(LOCAL_CPP_FLAG) STEP.F  $@

STEP.o: STEP.f
	$(FC) $(FFLAGS) -I.. -fno-underscoring -o $@ -c $<

clean:
	rm -f *.f *.o *.a *~