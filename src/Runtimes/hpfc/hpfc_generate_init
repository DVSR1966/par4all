#! /bin/sh
#
# $RCSfile: hpfc_generate_init,v $ ($Date: 1996/12/26 15:43:28 $, )
# version $Revision$
#
# generate the initialization file
#

script=`basename $0`
unset NAME 

usage()
{
  echo "Usage: $script [ -n name ] dirname" 1>&2
  exit 1
}

while getopts n: OPT
do
  case $OPT in
    n) NAME=$OPTARG ;;
    *) usage ;;
  esac
done

shift `expr $OPTIND - 1`

[ "$#" -eq 1 ] || usage

dirname=$1
init=$dirname/param_init.m4

NAME="${NAME:-`basename $dirname .database`}"
NAME=`echo $NAME | tr '[A-Z]' '[a-z]'`

# the key is used to check that the nodes and host do match...

key="${NAME}.`hostname`.`whoami`.`date +"%H.%M.%S.%j.%y"`"

{
  echo "      subroutine HPFC INIT COMMON PARAM"
  echo "      implicit none"
  echo "      include \"hpfc_commons.h\""
  #
  # must avoid the hpfc_ version. 
  # pips generates uppercase file names...
  #
  for file in $dirname/[A-Z]*_parameters.h
  do
    echo "      include \"`basename $file`\""
  done
  for file in $dirname/*_init.h
  do
    echo "      include \"`basename $file`\""
  done
  echo "! other initializations"
  echo "      MAIN PROGRAM NAME=\"${NAME}_main\""
  echo "      NODE PROGRAM NAME=\"${NAME}_node\""
  echo "      NODE ARCHITECTURE=\"PVM_ARCH\""
  echo "      HPFC GROUP NAME=\"${NAME}_group\""
  echo "      HPFC KEY=\"$key\""
  echo "      end"
} > $init

hpfc_add_warning $init

# end of $RCSfile: hpfc_generate_init,v $
