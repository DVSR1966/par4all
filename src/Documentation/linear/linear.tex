%%
%% $Id$
%%
%% Nos reflexions sur les manipulations de systèmes linéaires...
%%

\documentclass[a4paper,11pt]{article}
\usepackage{amsmath,amssymb,psfig}

\title{Linear Algebra as a Proof Engine}

\author{Corinne Ancourt \\
  Fabien Coelho \\
  François Irigoin}

\begin{document}

\maketitle

{\small
\begin{center}
\begin{verbatim}
 $Id$
\end{verbatim}
\end{center}
}

\begin{abstract}
Linear algebra algorithm can be used to prove program properties. However
its worse-case exponential complexity is a problem. The problem sizes must
be reduced as much as possible and sub-optimal or heuristics solution must
be found when arithmetic overflows occur.
\end{abstract}

\section{Introduction}

Integer linear programming, Fourier-Motzkin variable elimination, the
simplexe, PIP, Chernikova convex hull algorithm can be used on the integer
or rational domains to prove some properties in programs. These algorithms
often have a polynomial complexity but the worst-case exponential
complexity hits sometimes. Heuristics are needed to avoid infinite
precision arithmetic and to maintain an execution speed fast enough to
process large real applications of more than 100,000 lines of code with
hundreds of variables linked by hundreds of constraints.

Adding information about a program should always result in more accurate
analyses. It is not true when 32 or 64 bit integers are used. When
information is added, more overflows may occur in the linear algebra
algorithm and approximations must be made, resulting in less accurate
analyses.

Although linear algebra algorithms are appealing as simple and fast proof
engines, their usage in a compiler is not as straightforward as it seems
at first.

\section{Fourier-Motzkin Elimination and Feasability}

\section{Simplexe}

\section{Convex Hull}

\subsection{Definition}

Let $A$ et $B$ be two finite subsets of an affine or vector space $E$, the convex hull
of $A$ and $B$ is:

\begin{eqnarray}
\{ x ~ \in ~ E |
\exists~a~\in~A~~~\exists~b~\in~B~~~\exists~\lambda~\in~[0..1]~~s.t.~~ x =
\lambda a + (1 - \lambda b) \}
\end{eqnarray}

If $A$ or $B$ is not finite, the closure of the previous set is their
convex hull.

\subsection{Properties}

\begin{eqnarray}
A \subset A \vee A
\end{eqnarray}

\begin{eqnarray}
A = A \vee A \Longleftrightarrow A is convex
\end{eqnarray}

\subsubsection{Convex Hull and Intersection}

Since the computation of the convex hull of two sets is expensive, it would be nice to
reduce it by extracting common constraints and using the distributivity:

\begin{eqnarray} \label{equation-distributivity}
A \cap ( B_1 \vee B_2 ) = (A \cap B_1 ) \vee (A \cap B_2 )
\end{eqnarray}

Unfortunately, this property does not hold in general.

\begin{figure}
\begin{center}
% \mbox{\psfig{file=distrib01.idraw,width=0.3\hsize,height=0.3\vsize}}
\mbox{\psfig{file=distrib01.idraw}}
\end{center}
\caption{The convex hull should be performed first}
\label{figure-distrib01}
\end{figure}

For instance, look at figure~\ref{figure-distrib01}. The convex hull of
$B_1$ and $B_2$ is a segment which intersects $A$ whereas the
intersections of $A$ with $B_1$ and $B_2$ are both empty.

\begin{eqnarray}
A \cap ( B_1 \vee B_2 ) \not\subset (A \cap B_1 ) \vee (A \cap B_2 )
\end{eqnarray}

\begin{figure}
\begin{center}
% \mbox{\psfig{file=distrib02.idraw,width=0.3\hsize,height=0.3\vsize}}
\mbox{\psfig{file=distrib02.idraw}}
\end{center}
\caption{The intersection should be performed first}
\label{figure-distrib02}
\end{figure}

The converse is not true either. In Figure~\ref{figure-distrib02}, the
intersection of the circle $A$ with the convex hull of $B_1$ and $B_2$ is just $B_1$
and $B_2$. But the convex hull of $A \cap B_1$ and $A \cap B_2$ is the
diameter $[B_1 B_2]$.

\begin{eqnarray}
A \cap ( B_1 \vee B_2 ) \not\supset (A \cap B_1 ) \vee (A \cap B_2 )
\end{eqnarray}

If $A$ is convex (and $B_1$ abd $B_2$ are finite sets), then:

\begin{eqnarray}
A \cap ( B_1 \vee B_2 ) \supset (A \cap B_1 ) \vee (A \cap B_2 )
\end{eqnarray}

Proof: $x~\in~(A \cap B_1 ) \vee (A \cap B_2 )$ implies there exist $x_1$
and $x_2$ such that $x_1$ belongs to $A \cap B_1$ and $x_2$ belongs to $A
\cap B_2$, as well as $\lambda$ in $[0..1]$ and $x = \lambda x_1 +
(1-\lambda) x_2$. Since $x_1$ and $x_2$ belong to $A$ and since $A$ is
convex, $x$ belongs to $A$ by definition of convexity. Furthermore, $x$
belongs to $B_1 \cap B_2$ by definition of convex hull.

\begin{figure}
\begin{center}
% \mbox{\psfig{file=distrib03.idraw,width=0.3\hsize,height=0.3\vsize}}
\mbox{\psfig{file=distrib03.idraw}}
\end{center}
\caption{Distribution with an affine subset}
\label{figure-distrib03}
\end{figure}

If $A$ is a vector or affine subset, this is not a sufficient condition
for equation~\ref{equation-distributivity} to hold.In
  Figure~\ref{figure-distrib03}, let $A$ be the $(Ox, Oy)$ plane and $B_1$
  and $B_2$ two lines intersecting $A$ in $X$ and $Y$ respectively. The
  point $(1,1,0)$ belongs to the intersection of $A$ and the convex
  enveloppe of $B_1$ and $B_2$, which is generated by $X$, $Y$ and the two
  lines $(1,0,1)$ and $(0,1,-1)$, but not to the segment $[B_1 b_2]$ which is
  the convex hull of the intersections of $A$ with $B_1$ and $B_2$, namely
  $X=(1,0,0)$ and $Y=(0,1,0)$ respectively.

\[
\left( \begin{array}{c}
1 \\
1 \\
0 \\
\end{array}
\right)
 = \frac{1}{2} \left(
\left( \begin{array}{c}
1 \\
0 \\
0 \\
\end{array}
\right)
+
\left( \begin{array}{c}
0 \\
1 \\
0 \\
\end{array}
\right)
+
\left( \begin{array}{c}
1 \\
0 \\
1 \\
\end{array}
\right)
+
\left( \begin{array}{c}
0 \\
1 \\
-1\\
\end{array}
\right)
\right)
\]

Stronger conditions than convexity are needed on $A$, $B_1$ and $B_2$ for the distributivity to hold (Equation~\ref{equation-distributivity}).

Note however that:

\[
(A \cap B_1 ) \vee (A \cap B_2 ) \subset A \cap (B_1 \vee B_2) \subset A
\]

Hence $A$ can be used as an upper-approximation of $(A \cap B_1 ) \vee (A
\cap B_2 )$ and common constraints in $C$ and $D$ can be used as an
upper-approximation of $C \vee D$.

\subsubsection{Decomposition with Free Affine Subspaces}

Let assume that $A$ intersects $B_1$ and $B_2$ and let $a_1 ~\in~A \cap
B_1$ and $a_2 ~\in~A \cap B_2$.

Let assume that all generating vectors of $A$ are free with respect to the
generating vectors of $B_1$ and $B_2$.

For all $x$ in $A \cap ( B_1 \vee B_2)$, there exists $x_1$ in $B_1$,
$x_2$ in $B_2$ and $\lambda$ in $[0..1]$ such that:

\[
x = \lambda x_1 + ( 1 - \lambda ) x_2
\]

Since $B_1$ and $B_2$ are affine subspace:

\[
x_1 = a_1 + \sum_{i=1}^{n_1} c^1_i e^1_i
\]

\[
x_2 = a_2 + \sum_{i=1}^{n_2} c^2_i e^2_i
\]

and

\[
x = \lambda a_1 + ( 1 - \lambda ) a_2
  + \sum_{i=1}^{n_1} \lambda c^1_i e^1_i
  + \sum_{i=1}^{n_2} (1-\lambda)c^2_i e^2_i
\]

Since neither $e^1_i$ nor $e^2_i$ vectors are generators for $A$ and since
$A$ is convex:

\[
x = \lambda a_1 + ( 1 - \lambda ) a_2~\in~A
\]

Since $a_1$ belongs to $A \cap B_1$ and $a_2$ belongs to $A \cap B_2$, $x$
belongs to $(A \cap B_1) \vee (A \cap B_2)$.

\paragraph{Theorem:} If $A$ is an affine subspace intersecting affine
subspaces $B_1$ and $B_2$ and if all generating vectors in $A$ are free
with respect to $B_1$ and $B_2$, then:

\[
A \cap ( B_1 \vee B_2 ) = (A \cap B_1 ) \vee (A \cap B_2 )
\]

The same property might hold for convex sets by considering the smallest
affine subsets containg them.

\subsubsection{Decomposition with Free Complementary Subspaces}

Must be Fabien's decomposition, or a more general one or nothing?

This approach is dual to the previous one. Complementary (should we use
orthogonal ones?) subspaces are
linked to affine constraints.

Let $A$, $B_1$ and $B_2$ be affine subsets such that the vector
complementary/orthogonal subspace of $A$ is free with respect to the vector
complementary/orthogonal subspaces of $B_1$ and $B_2$.

TO BE DONE.

\subsubsection{Decomposition by Fabien and Corinne}

\[
 P1 \vee P2 = (P \cap X1) \vee (P \cap X2)
\]

Let $ P = P' \cap P'' $ so that $P' \bot X1$ and $P' \bot X2$ and $P' \bot P''$ built
by transitive closure, then:

\[
P1 \vee P2 = (P' \cap (P'' \cap X1)) \vee (P' \cap (P'' \cap X2)) =
                 P' \cap ((P'' \cap X1) \vee (P'' \cap X2))
\]

Proof by considering the generating systems:

Lemma:

\begin{eqnarray}
 A \bot B <=> var(A) \cap var(B) = 0
\end{eqnarray}

\paragraph{Property (?):} $A \cap B$ if $A \bot B$

Let $A = (x,v,l)$, $B = (y,w,m)$

\[
\begin{array}{lcl}
A \cap B &=& \left\{ z | z = (x) \mu + (v) d + (l) e + (0) f \right.\\
         & &       (0)     + (0)   + (0)     (I) \\
         & & \wedge z = (0) \nu + (0) g + (0) h + (I) f' \\
         & &         (y)     + (w)   + (m)     (0) \\
         & &  \left. with \mu>0, \nu>0, \sum\mu=1, \sum\nu=1, d>0, g>0 \right\}
\end{array}
\]

We can always find $f$ and $f'$ equals to the other part (by extension)
so:

\[
\begin{array}{lcl}
A \cap B &=& \left\{ z | z = (x 0) \mu + (v 0) d + (l 0) e \right.\\
         & &      (0 y) \nu   (0 w) g   (0 m) h  \\
         & & \left. with \mu \nu d g constraints... \right\}
\end{array}
\]

It is a convex : 

\[
\begin{array}{l}
((xi)  , (v 0), (l 0)) \\
 (yj)ij, (0 w), (0 m)
\end{array}
\]

We just need to prove that $Cmn = Cg$ defined as:

\[
\begin{array}{l}
  (x 0) \mu  ==  (xi)   \gamma with >0 \wedge \sum = 1 \\
  (0 y) \nu      (yj)ij
\end{array}
\]

$Cg$ is included in a convex.

$Cg \in Cmn$ since $((xi)|(yj) ij)$ is in $Cmn$ 
  with $\mu = \delta i$, $\nu = \delta j$

$Cmn \in Cg$ by chosing $\gamma_ij = \mu_i\nu_j$, which $>0$ and $\sum = 1$

\paragraph{Lemma}: If $A$ is orthogonal to $B$ and $C$, it is orthogonal
to their convex hull and to their intersection.

\begin{eqnarray}
A \bot B \wedge A \bot C => A \bot (B \vee C) \wedge A \bot (B \cap C)
\end{eqnarray}

\paragraph{Theorem:} If $A$ is orthogonal to both $B$ and $C$ then the
intersection is distributive with respect to the convex hull:

\begin{eqnarray}
A \bot B \wedge A \bot C => (A \cap B) \vee (A \cap C) = A \cap (B \vee C)
\end{eqnarray}

compute both generating systems with above props. they are equal.

\subsection{Heuristics}

If an overflow occurs during the computation of a convex hull $A_1 \vee
A_2$, and if there exist $A$, $B_1$ and $B_2$ convex sets such that:

\[
A_1 = A \cap B_1 ~~~\wedge~~~ A_2 = A \cap B_2
\]

then $A$ and $A \cap (B_1 \vee B_2)$ are over-approximations of $A_1 \vee
A_2$.

\section{Experiments}

\section{Conclusion}

\end{document}
