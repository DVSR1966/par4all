#!/bin/sh
#
# $RCSfile: make-builder-map,v $ (version $Revision$)
# $Date: 1996/08/20 08:43:59 $, 

# Derivation of builder_map.h from pipsmake.rc

# By default (no argument), automatic declaration generation
# Else, retrieve declarations in include files
# feature removed... automatic generation only.

# Francois Irigoin, 8 October 1993

# REAL="$1"

functions=`/lib/cpp $PIPS_ROOT/Share/pipsmake.rc | grep '^[a-z]' | \
		sed 's/ .*//' |	sort | uniq `

# echo $functions >/dev/tty

cat >decl$$ <<EOF
/*
 *         --------------------------------------------------------
 *         --------------------------------------------------------
 *
 *                                  WARNING
 *
 *                THIS FILE HAS BEEN AUTOMATICALLY GENERATED
 *
 *                             DO NOT MODIFY IT
 *
 *         --------------------------------------------------------
 *         --------------------------------------------------------
 */
EOF

cat >map$$ <<EOF

static struct builder_map {
    char *builder_name;
    bool (*builder_func)(char *);
} builder_maps[] = {

EOF

for func in $functions
do
  # echo $func
  FUNC=`echo $func | tr a-z A-Z`
  echo "extern bool $func(char *);" >>decl$$
  echo "    { BUILDER_$FUNC, $func }," >>map$$
done

cat >>map$$ <<EOF

    { NULL, NULL }
};
EOF

cat $PIPS_ROOT/Include/auto.h decl$$ map$$ >$PIPS_ROOT/Include/builder_map.h

/bin/rm -f decl$$ map$$
