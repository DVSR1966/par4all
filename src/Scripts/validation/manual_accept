#! /bin/bash
#
# $Id$

svn=
shopt -s nullglob

# what is the current arch?
arch=${PIPS_ARCH:-$($PIPS_ROOT/makes/arch.sh)}

for dir ; do
  if [[ -d $dir ]] ;  then 
    pushd $dir > /dev/null
    for file in *.result/out ; do 
      ref=${file%\/out}/test
      [ -f $ref.$arch ] && ref=$ref.$arch

      # show differences
      if [ -f $file ] ; then
	echo "CONSIDERING $ref and $file"
        ${PIPS_DIFF:-diff -b -u} $ref $file 
      else
	echo "NEW OUTPUT $file"
	cat $file 
      fi | ${PIPS_MORE:-less}
      
      echo -e "accept (y|n)?\a"
      read answer
      if [[ $answer == [yY]* ]] ; then 
	  mv $file $ref
	  [[ -d '.svn' ]] && svn=1
      fi
    done
    popd > /dev/null
  fi
done

[[ $svn ]] && echo "Consider running \"svn ci $@\" to commit changes"

exit 0
