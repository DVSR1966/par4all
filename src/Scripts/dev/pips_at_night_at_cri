#! /bin/bash
#
# $Id$
#
# what to do at night from the pips account at cri.

umask 022

email=pips-validation@cri.ensmp.fr
target=~/PIPS

# set environment...
test -f $target/pipsrc.sh && source $target/pipsrc.sh

start=$(date)

pips_at_night -t $target -m $email -u -c -v "$@" \
    > out.$$ 2> err.$$

mv out.$$ $target/out
mv err.$$ $target/err

end=$(date)

{
  echo "target=$target"
  echo "out=$target/out"
  echo "err=$target/err"
  echo "email=$email"
  echo "start=$start"
  echo "end=$end"
  echo
  echo "pips: $(svnversion $target/prod/pips)"
  echo "newgen: $(svnversion $target/prod/newgen)"
  echo "linear: $(svnversion $target/prod/linear)"
  echo "nlpmake: $(svnversion $target/prod/pips/makes)"
  echo "valid: $(svnversion $target/valid)"
} | ${PIPS_MAIL:-Mail} -s '[pips] night job summary' $email
