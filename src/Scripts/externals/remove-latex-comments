#!/bin/sh
# Conversion d'un fichier Latex en un fichier NewGen
#
# Remi Triolet
#
# Modifications
#  - ajout de l'option bidon "-" aux commandes "echo" (FI, 29/12/89)
#  - suppression de la mise en minuscule pour les "external domains"
#    (FI, 29/12/89)
#  - remplacement de la mise en minuscule systematique des domaines
#    definies par la mise en minuscule du PREMIER caractere de chaque
#    declaration NewGen pour conserver la belle presentation du
#    chef de projet-president :-) (FI, 29/12/89)

input=$1
output=`basename $1 .f.tex`.newgen

cat > $output <<!
--	   --------------------------------------------------------
--	   --------------------------------------------------------
--
--				    WARNING
--
--		  THIS FILE HAS BEEN AUTOMATICALLY GENERATED
--
--			       DO NOT MODIFY IT
--
--	   --------------------------------------------------------
--	   --------------------------------------------------------
!

echo >> $output
echo "-- Imported domains" >> $output
echo "-- ----------------" >> $output
egrep '^\\domain' < $input | egrep -i 'import' |
	sed 's/\\domain{//' | 
	sed 's/}/ ;/' | 
	tr A-Z a-z |
	tr -d \\\\ |
	sort >> $output

echo >> $output
echo "-- External domains" >> $output
echo "-- ----------------" >> $output
egrep '^\\domain' < $input | egrep -i 'external' |
	sed 's/\\domain{//; s/}/ ;/; s/^A/a/; s/^B/b/; s/^C/c/; s/^D/d/; 
		   s/^E/e/; s/^F/f/; s/^G/g/; s/^H/h/; s/^I/i/; s/^J/j/;
		   s/^K/k/; s/^L/l/; s/^M/m/; s/^N/n/; s/^O/o/; s/^P/p/;
	           s/^Q/q/; s/^R/r/; s/^S/s/; s/^T/t/; s/^U/u/; s/^V/v/;
		   s/^W/w/; s/^X/x/; s/^Y/y/; s/^Z/z/; ' | 
#	sed 's/\\domain{//' | 
#	sed 's/} *$/ ;/' | 
#	tr A-Z a-z |
	tr -d \\\\ |
	sort >> $output

echo >> $output
echo "-- Domains" >> $output
echo "-- -------" >> $output
egrep '^\\domain' < $input | egrep -i '=' |
	sed 's/\\domain{//; s/} *$/ ;/; s/^A/a/; s/^B/b/; s/^C/c/; s/^D/d/; 
		   s/^E/e/; s/^F/f/; s/^G/g/; s/^H/h/; s/^I/i/; s/^J/j/;
		   s/^K/k/; s/^L/l/; s/^M/m/; s/^N/n/; s/^O/o/; s/^P/p/;
	           s/^Q/q/; s/^R/r/; s/^S/s/; s/^T/t/; s/^U/u/; s/^V/v/;
		   s/^W/w/; s/^X/x/; s/^Y/y/; s/^Z/z/; ' | 
	tr -d \\\\ |
	sort >> $output
