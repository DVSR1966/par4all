--- Regions for Extr

C  <T(PHI1,PHI2,PHI3)-R-MAY-{J1<=PHI1, PHI1<=JA, 1<=PHI2, PHI2<=3+K1,
C    PHI2<=21, J2==2JA-1, 2<=J1, 2<=K1}>
C  <T(PHI1,PHI2,PHI3)-W-MAY-{PHI2==1, J1<=PHI1, PHI1+1<=2JA,
C    3+NC<=PHI3, PHI3<=5+NC, J2==2JA-1, 2<=J1, J1<=JA, 2<=K1}>

      SUBROUTINE EXTR(NI,NC)
C********************************************************
C     CALCULE LES COEFFICIENTS D EXTRAPOLATION
C     SUR LA SURFACE DE L AILE  (K=K1)
C********************************************************
      DIMENSION T(52,21,60)
      COMMON/CT/T
      COMMON/CI/I1,I2,IMAX,I1P1,I1P2,I2M1,I2M2,IBF
      COMMON/CJ/J1,J2,JMAX,J1P1,J1P2,J2M1,J2M2,JA,JB,JAM1,JBP1
      COMMON/CK/K1,K2,KMAX,K1P1,K1P2,K2M1,K2M2
      COMMON/CNI/L
      L = NI                                                            0001
      K = K1                                                            0002

C  <T(PHI1,PHI2,PHI3)-R-MAY-{J1<=PHI1, PHI1<=JA, 1<=PHI2, PHI2<=3+K,
C    PHI2<=21, J2==2JA-1, K==K1, L==NI, 2<=J1, 2<=K}>
C  <T(PHI1,PHI2,PHI3)-W-MAY-{PHI2==1, J1<=PHI1, PHI1+1<=2JA,
C    3+NC<=PHI3, PHI3<=5+NC, J2==2JA-1, K==K1, L==NI, 2<=J1, J1<=JA,
C    2<=K}>

      DO 300 J = J1, JA                                                 0003

C  <T(PHI1,PHI2,PHI3)-R-EXACT-{PHI1==J, PHI1<=52, K<=PHI2, PHI2<=1+K,
C    PHI2<=21, L<=PHI3, 1<=PHI3, PHI3<=2+L, PHI3<=60, J2==2JA-1,
C    K==K1, L==NI, J1<=J, J<=JA, 2<=J1, 2<=K}>

         S1 = D(J, K, J, K+1)                                           0004

C  <T(PHI1,PHI2,PHI3)-R-EXACT-{PHI1==J, PHI1<=52, 1+K<=PHI2,
C    PHI2<=2+K, PHI2<=21, L<=PHI3, 1<=PHI3, PHI3<=2+L, PHI3<=60,
C    J2==2JA-1, K==K1, L==NI, J1<=J, J<=JA, 2<=J1, 2<=K}>

         S2 = D(J, K+1, J, K+2)+S1                                      0005

C  <T(PHI1,PHI2,PHI3)-R-EXACT-{PHI1==J, PHI1<=52, 2+K<=PHI2,
C    PHI2<=3+K, PHI2<=21, L<=PHI3, 1<=PHI3, PHI3<=2+L, PHI3<=60,
C    J2==2JA-1, K==K1, L==NI, J1<=J, J<=JA, 2<=J1, 2<=K}>

         S3 = D(J, K+2, J, K+3)+S2                                      0006

C  <T(PHI1,PHI2,PHI3)-W-EXACT-{PHI1==J, PHI2==1, PHI3==NC+3,
C    J2==2JA-1, K==K1, L==NI, J1<=J, J<=JA, 2<=J1, 2<=K}>

         T(J,1,NC+3) = S2*S3/((S1-S2)*(S1-S3))                          0007

C  <T(PHI1,PHI2,PHI3)-W-EXACT-{PHI1==J, PHI2==1, PHI3==NC+4,
C    J2==2JA-1, K==K1, L==NI, J1<=J, J<=JA, 2<=J1, 2<=K}>

         T(J,1,NC+4) = S3*S1/((S2-S3)*(S2-S1))                          0008

C  <T(PHI1,PHI2,PHI3)-W-EXACT-{PHI1==J, PHI2==1, PHI3==NC+5,
C    J2==2JA-1, K==K1, L==NI, J1<=J, J<=JA, 2<=J1, 2<=K}>

         T(J,1,NC+5) = S1*S2/((S3-S1)*(S3-S2))                          0009
         JH = J1+J2-J                                                   0010

C  <T(PHI1,PHI2,PHI3)-R-EXACT-{PHI1==J, PHI2==1, PHI3==NC+3,
C    J+JH==J1+2JA-1, J2==2JA-1, K==K1, L==NI, J1<=J, J<=JA, 2<=J1,
C    2<=K}>
C  <T(PHI1,PHI2,PHI3)-W-EXACT-{PHI1==JH, PHI2==1, PHI3==NC+3,
C    J+JH==J1+2JA-1, J2==2JA-1, K==K1, L==NI, J1<=J, J<=JA, 2<=J1,
C    2<=K}>

         T(JH,1,NC+3) = T(J,1,NC+3)                                     0011

C  <T(PHI1,PHI2,PHI3)-R-EXACT-{PHI1==J, PHI2==1, PHI3==NC+4,
C    J+JH==J1+2JA-1, J2==2JA-1, K==K1, L==NI, J1<=J, J<=JA, 2<=J1,
C    2<=K}>
C  <T(PHI1,PHI2,PHI3)-W-EXACT-{PHI1==JH, PHI2==1, PHI3==NC+4,
C    J+JH==J1+2JA-1, J2==2JA-1, K==K1, L==NI, J1<=J, J<=JA, 2<=J1,
C    2<=K}>

         T(JH,1,NC+4) = T(J,1,NC+4)                                     0012

C  <T(PHI1,PHI2,PHI3)-R-EXACT-{PHI1==J, PHI2==1, PHI3==NC+5,
C    J+JH==J1+2JA-1, J2==2JA-1, K==K1, L==NI, J1<=J, J<=JA, 2<=J1,
C    2<=K}>
C  <T(PHI1,PHI2,PHI3)-W-EXACT-{PHI1==JH, PHI2==1, PHI3==NC+5,
C    J+JH==J1+2JA-1, J2==2JA-1, K==K1, L==NI, J1<=J, J<=JA, 2<=J1,
C    2<=K}>

         T(JH,1,NC+5) = T(J,1,NC+5)                                     0013
300      CONTINUE                                                       0014

      END
--- Parallelized version of Extr
      SUBROUTINE EXTR(NI,NC)
C********************************************************
C     CALCULE LES COEFFICIENTS D EXTRAPOLATION
C     SUR LA SURFACE DE L AILE  (K=K1)
C********************************************************
      DIMENSION T(52,21,60)
      COMMON/CT/T
      COMMON/CI/I1,I2,IMAX,I1P1,I1P2,I2M1,I2M2,IBF
      COMMON/CJ/J1,J2,JMAX,J1P1,J1P2,J2M1,J2M2,JA,JB,JAM1,JBP1
      COMMON/CK/K1,K2,KMAX,K1P1,K1P2,K2M1,K2M2
      COMMON/CNI/L
      L = NI                                                            0001
      K = K1                                                            0002
      DOALL J = J1, JA                                                  0003
         PRIVATE S3,S2,S1
         S1 = D(J, K, J, K+1)                                           0004
         S2 = D(J, K+1, J, K+2)+S1                                      0005
         S3 = D(J, K+2, J, K+3)+S2                                      0006
         T(J,1,NC+3) = S2*S3/((S1-S2)*(S1-S3))                          0007
         T(J,1,NC+4) = S3*S1/((S2-S3)*(S2-S1))                          0008
         T(J,1,NC+5) = S1*S2/((S3-S1)*(S3-S2))                          0009
      ENDDO
      DOALL J = J1, JA                                                  0003
         PRIVATE JH
         JH = J1+J2-J                                                   0010
         T(JH,1,NC+3) = T(J,1,NC+3)                                     0011
         T(JH,1,NC+4) = T(J,1,NC+4)                                     0012
         T(JH,1,NC+5) = T(J,1,NC+5)                                     0013
      ENDDO

      END
