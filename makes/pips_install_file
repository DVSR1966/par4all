#! /bin/sh
#
# install a file only if different from the one already installed.
#
# Fabien COELHO, 03/08/95
#
# $RCSfile: pips_install_file,v $ (version $Revision$)
# ($Date: 1996/09/02 09:15:50 $, )
#

RUN=':'
script=`basename $0`

verb()
{ echo $script: "$@" >&2 ;}

usage()
{
  echo "usage: $script -(f|l|x|r prgm)  directory files ($2)";
  exit ${1:-1}
}

while getopts flxr: opt
do
  case $opt in
    f) RUN=':' ;;
    l) RUN='ranlib' ;;
    x) RUN='chmod a+rx-w' ;;
    r) RUN="$OPTARG" ;;
    *) usage 4 "unexpected option ($opt)" ;;
  esac
done

shift `expr $OPTIND - 1`

[ $# -eq 0 ] && usage 2 "invalid number of arguments"
directory=$1
shift
[ -f $directory ] && usage 3 "$directory is not a directory"
[ -d $directory ] || mkdir $directory

verb "installing in $directory"

# test if different

for file
do
  base=`basename $file`
  target=$directory/$base
  if [ -d $file ] 
  then
    if test $base = OLD -o $base = SCCS
    then 
      verb "skipping directory $file"
    else
      verb "recursing for directory $file"
      rm -rf $target
      test -d $target || { mkdir $target; chmod a+rx,ug+w,o-w $target; }
      $0 $target `ls -d $file/* | sed '/OLD/d;/SCCS/d'`
    fi
  else
    if test -f $target && cmp -s $file $target
    then
	verb "skipping $file"
    else
	verb "copying $file"
	test ! -f $target || rm -f $target
	cp $file $directory
	eval "$RUN $target"
	chmod a+r-w $target
	test ! -x $file || chmod a+x $target
    fi
  fi
done

# that is all
#
