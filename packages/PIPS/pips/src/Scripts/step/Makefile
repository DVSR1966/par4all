# $Id: Makefile 12535 2006-08-17 17:41:40Z coelho $

LOCAL_CPP_FLAG = -P -traditional-cpp

F.sh = 	step_directives run_step.script	step_install

INSTALL_EXE = $(F.sh)

INSTALL_SHR = STEP.f STEP.h

# common stuff
ROOT    = ../../..
PROJECT = pips
include $(ROOT)/makes/main.mk

# local stuff
FILTRE = ./filtre_macro

COM_SUBROUTINES.f: COM_SUBROUTINES.F
	cpp $(LOCAL_CPP_FLAG) -U INTERLACED $< | $(FILTRE) > $@

COM_SUBROUTINES_BODY.f: COM_SUBROUTINES.f STEP_COM_SUBROUTINES_BODY.F
	cpp $(LOCAL_CPP_FLAG) -U INTERLACED STEP_COM_SUBROUTINES_BODY.F | $(FILTRE) > $@

STEP_COM_SUBROUTINES_BODY.f: COM_SUBROUTINES_BODY.f
	cpp $(LOCAL_CPP_FLAG) -U INTERLACED $< | $(FILTRE) > $@

COM_SUBROUTINES_INTERLACED.f: COM_SUBROUTINES.F
	cpp $(LOCAL_CPP_FLAG) -D INTERLACED $< | $(FILTRE) > $@

COM_SUBROUTINES_BODY_INTERLACED.f: COM_SUBROUTINES_INTERLACED.f STEP_COM_SUBROUTINES_BODY.F
	cpp $(LOCAL_CPP_FLAG) -D INTERLACED STEP_COM_SUBROUTINES_BODY.F | $(FILTRE) > $@

STEP_COM_SUBROUTINES_BODY_INTERLACED.f: COM_SUBROUTINES_BODY_INTERLACED.f
	cpp $(LOCAL_CPP_FLAG) -D INTERLACED $< | $(FILTRE) > $@

STEP.f: STEP.h default/README STEP.F STEP_COM_SUBROUTINES_BODY.f STEP_COM_SUBROUTINES_BODY_INTERLACED.f
	cpp $(LOCAL_CPP_FLAG) STEP.F $@
	cat default/README STEP.h >default/STEP.h

clean: local-clean

local-clean:
	$(RM) *.f default/STEP.h
