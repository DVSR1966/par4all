
File mnbrak.database/mnbrak/mnbrak.c

# 10
void mnbrak(ax,bx,cx,fa,fb,fc,func)
float *ax,*bx,*cx,*fa,*fb,*fc;
float (*func)(); /* ANSI: float (*func)(float); */
{
        float ulim,u,r,q,fu,dum;

        *fa=(*func)(*ax);
        *fb=(*func)(*bx);
        if (*fb > *fa) {
                (dum)=(*ax);(*ax)=(*bx);(*bx)=(dum);
                (dum)=(*fb);(*fb)=(*fa);(*fa)=(dum);
        }
        *cx=(*bx)+1.618034*(*bx-*ax);
        *fc=(*func)(*cx);
        while (*fb > *fc) {
                r=(*bx-*ax)*(*fb-*fc);
                q=(*bx-*cx)*(*fb-*fa);
                u=(*bx)-((*bx-*cx)*q-(*bx-*ax)*r)/
                        (2.0*((q-r) > 0.0 ? fabs(((fabs(q-r)) > (1.0e-20) ? (fabs(q-r)) : (1.0e-20))) : -fabs(((fabs(q-r)) > (1.0e-20) ? (fabs(q-r)) : (1.0e-20)))));
                ulim=(*bx)+100.0*(*cx-*bx);
                if ((*bx-u)*(u-*cx) > 0.0) {
                        fu=(*func)(u);
                        if (fu < *fc) {
                                *ax=(*bx);
                                *bx=u;
                                *fa=(*fb);
                                *fb=fu;
                                return;
                        } else if (fu > *fb) {
                                *cx=u;
                                *fc=fu;
                                return;
                        }
                        u=(*cx)+1.618034*(*cx-*bx);
                        fu=(*func)(u);
                } else if ((*cx-u)*(u-ulim) > 0.0) {
                        fu=(*func)(u);
                        if (fu < *fc) {
                                (*bx)=(*cx);(*cx)=(u);(u)=(*cx+1.618034*(*cx-*bx));
                                (*fb)=(*fc);(*fc)=(fu);(fu)=((*func)(u));
                        }
                } else if ((u-ulim)*(ulim-*cx) >= 0.0) {
                        u=ulim;
                        fu=(*func)(u);
                } else {
                        u=(*cx)+1.618034*(*cx-*bx);
                        fu=(*func)(u);
                }
                (*ax)=(*bx);(*bx)=(*cx);(*cx)=(u);
                (*fa)=(*fb);(*fb)=(*fc);(*fc)=(fu);
        }
}
