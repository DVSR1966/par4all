# 9
float brent(ax,bx,cx,f,tol,xmin)
float ax,bx,cx,tol,*xmin;
float (*f)(); /* ANSI: float (*f)(float); */
{
 int iter;
 float a,b,d,etemp,fu,fv,fw,fx,p,q,r,tol1,tol2,u,v,w,x,xm;
 float e=0.0;
 void nrerror();

 a=((ax < cx) ? ax : cx);
 b=((ax > cx) ? ax : cx);
 x=w=v=bx;
 fw=fv=fx=(*f)(x);
 for (iter=1;iter<=100;iter++) {
  xm=0.5*(a+b);
  tol2=2.0*(tol1=tol*fabs(x)+1.0e-10);
  if (fabs(x-xm) <= (tol2-0.5*(b-a))) {
   *xmin=x;
   return fx;
  }
  if (fabs(e) > tol1) {
   r=(x-w)*(fx-fv);
   q=(x-v)*(fx-fw);
   p=(x-v)*q-(x-w)*r;
   q=2.0*(q-r);
   if (q > 0.0) p = -p;
   q=fabs(q);
   etemp=e;
   e=d;
   if (fabs(p) >= fabs(0.5*q*etemp) || p <= q*(a-x) || p >= q*(b-x))
    d=0.3819660*(e=(x >= xm ? a-x : b-x));
   else {
    d=p/q;
    u=x+d;
    if (u-a < tol2 || b-u < tol2)
     d=((xm-x) > 0.0 ? fabs(tol1) : -fabs(tol1));
   }
  } else {
   d=0.3819660*(e=(x >= xm ? a-x : b-x));
  }
  u=(fabs(d) >= tol1 ? x+d : x+((d) > 0.0 ? fabs(tol1) : -fabs(tol1)));
  fu=(*f)(u);
  if (fu <= fx) {
   if (u >= x) a=x; else b=x;
   (v)=(w);(w)=(x);(x)=(u);
   (fv)=(fw);(fw)=(fx);(fx)=(fu);
  } else {
   if (u < x) a=u; else b=u;
   if (fu <= fw || w == x) {
    v=w;
    w=u;
    fv=fw;
    fw=fu;
   } else if (fu <= fv || v == x || v == w) {
    v=u;
    fv=fu;
   }
  }
 }
 nrerror("Too many iterations in BRENT");
 *xmin=x;
 return fx;
}
